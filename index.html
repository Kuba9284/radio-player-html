<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BBC Radio Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
:root {
  --glass: rgba(20, 20, 30, 0.6);
  --border: #4b4bff;
  --accent: #7a7aff;
  --text: #ffffff;
}

* {
  box-sizing: border-box;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

body {
  margin: 0;
  height: 100vh;
  background: url("bg.png") center / cover no-repeat fixed;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ===== WINDOW (bigger than 4:3, smaller than 16:9) ===== */
.window {
  width: 1100px;
  height: 760px;
  backdrop-filter: blur(18px);
  background: var(--glass);
  border: 2px solid var(--border);
  border-radius: 20px;
  display: grid;
  grid-template-columns: 380px 1fr;
  padding: 22px;
  gap: 22px;
}

/* ===== LEFT PANEL ===== */
.left {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.album {
  width: 300px;
  height: 300px;
  border-radius: 18px;
  border: 2px solid var(--border);
  overflow: hidden;
}

.album img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  animation: breathe 6s ease-in-out infinite;
}

.station-name {
  font-size: 30px;
  font-weight: 700;
  color: var(--text);
}

.now-playing {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  color: #cfcfff;
}

.live-dot {
  width: 8px;
  height: 8px;
  background: red;
  border-radius: 50%;
  animation: pulse 1.4s infinite;
}

.metadata {
  font-size: 15px;
  color: #d6d6ff;
  min-height: 20px;
}

.controls {
  margin-top: 6px;
}

button {
  background: rgba(80,80,255,0.25);
  border: 1px solid var(--border);
  color: white;
  padding: 10px 18px;
  border-radius: 12px;
  cursor: pointer;
  transition: 0.25s ease;
}

button:hover {
  background: rgba(120,120,255,0.45);
  transform: translateY(-1px);
}

/* ===== RIGHT PANEL ===== */
.right {
  display: flex;
  flex-direction: column;
  gap: 10px;
  overflow-y: auto;
  padding-right: 6px;
}

/* Scrollbar */
.right::-webkit-scrollbar {
  width: 6px;
}
.right::-webkit-scrollbar-thumb {
  background: rgba(120,120,255,0.35);
  border-radius: 10px;
}

/* ===== STATION CARD ===== */
.station {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 10px 14px;
  border-radius: 14px;
  border: 1px solid var(--border);
  background: rgba(0,0,0,0.25);
  cursor: pointer;
  transition:
    background 0.25s ease,
    transform 0.25s ease,
    box-shadow 0.25s ease;
  animation: slideIn 0.4s ease forwards;
}

.station img {
  width: 50px;
  height: 50px;
  border-radius: 10px;
}

.station span {
  font-size: 16px;
  color: white;
}

.station:hover {
  transform: translateX(6px);
  background: rgba(80,80,255,0.25);
}

.station.active {
  background: rgba(120,120,255,0.35);
  box-shadow: 0 0 18px rgba(120,120,255,0.55);
  animation: pulse 2.5s infinite;
  position: relative;
}

.station.active::before {
  content: "";
  position: absolute;
  left: -2px;
  top: 12%;
  width: 4px;
  height: 76%;
  background: var(--accent);
  border-radius: 10px;
}

/* ===== ANIMATIONS ===== */
@keyframes pulse {
  0% { box-shadow: 0 0 0 rgba(120,120,255,0.4); }
  50% { box-shadow: 0 0 18px rgba(120,120,255,0.9); }
  100% { box-shadow: 0 0 0 rgba(120,120,255,0.4); }
}

@keyframes breathe {
  0% { transform: scale(1); }
  50% { transform: scale(1.015); }
  100% { transform: scale(1); }
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}
</style>
</head>
<body>

<div class="window">

  <!-- LEFT -->
  <div class="left">
    <div class="album">
      <img id="cover" src="icons/bbc1.png">
    </div>

    <div id="stationName" class="station-name">BBC Radio 1</div>

    <div class="now-playing">
      <span class="live-dot"></span> LIVE
    </div>

    <div id="metadata" class="metadata">Loading metadata…</div>

    <div class="controls">
      <button onclick="togglePlay()">▶ / ❚❚</button>
    </div>
  </div>

  <!-- RIGHT -->
  <div class="right" id="stations"></div>

</div>

<audio id="audio"></audio>

<script>
const stations = [
  { name: "BBC Radio 1", icon: "icons/bbc1.png",
    url: "http://as-hls-ww-live.akamaized.net/pool_01505109/live/ww/bbc_radio_one/bbc_radio_one.isml/bbc_radio_one-audio%3d96000.norewind.m3u8",
    serviceId: "radio1" },
  { name: "BBC Radio 1Xtra", icon: "icons/bbc1x.png",
    url: "http://as-hls-ww-live.akamaized.net/pool_92079267/live/ww/bbc_1xtra/bbc_1xtra.isml/bbc_1xtra-audio%3d96000.norewind.m3u8",
    serviceId: "1xtra" },
  { name: "BBC Radio 2", icon: "icons/bbc2.png",
    url: "http://as-hls-ww-live.akamaized.net/pool_74208725/live/ww/bbc_radio_two/bbc_radio_two.isml/bbc_radio_two-audio%3d96000.norewind.m3u8",
    serviceId: "radio2" },
  { name: "BBC Radio 3", icon: "icons/bbc3.png",
    url: "http://as-hls-ww-live.akamaized.net/pool_23461179/live/ww/bbc_radio_three/bbc_radio_three.isml/bbc_radio_three-audio%3d96000.norewind.m3u8",
    serviceId: "radio3" },
  { name: "BBC Radio 4 Extra", icon: "icons/bbc4.png",
    url: "http://as-hls-ww-live.akamaized.net/pool_26173715/live/ww/bbc_radio_four_extra/bbc_radio_four_extra.isml/bbc_radio_four_extra-audio%3d96000.norewind.m3u8",
    serviceId: "radio4extra" },
  { name: "BBC Radio 6 Music", icon: "icons/bbc6.png",
    url: "http://as-hls-ww-live.akamaized.net/pool_81827798/live/ww/bbc_6music/bbc_6music.isml/bbc_6music-audio%3d96000.norewind.m3u8",
    serviceId: "6music" },
  { name: "BBC World Service", icon: "icons/worldservice.png",
    url: "http://as-hls-ww-live.akamaized.net/pool_10162783/live/ww/bbc_world_service/bbc_world_service.isml/bbc_world_service-audio%3d96000.norewind.m3u8",
    serviceId: "worldserviceradio" }
];

const audio = document.getElementById("audio");
const list = document.getElementById("stations");
const metadataEl = document.getElementById("metadata");

let hls;
let currentStation;
let metadataTimer;

stations.forEach((s, i) => {
  const div = document.createElement("div");
  div.className = "station" + (i === 0 ? " active" : "");
  div.style.animationDelay = `${i * 60}ms`;
  div.innerHTML = `<img src="${s.icon}"><span>${s.name}</span>`;
  div.onclick = () => playStation(i);
  list.appendChild(div);
});

function playStation(index) {
  document.querySelectorAll(".station").forEach(e => e.classList.remove("active"));
  document.querySelectorAll(".station")[index].classList.add("active");

  currentStation = stations[index];
  document.getElementById("cover").src = currentStation.icon;
  document.getElementById("stationName").textContent = currentStation.name;
  metadataEl.textContent = "Loading metadata…";

  if (metadataTimer) clearInterval(metadataTimer);
  fetchMetadata();
  metadataTimer = setInterval(fetchMetadata, 20000);

  if (Hls.isSupported()) {
    if (hls) hls.destroy();
    hls = new Hls();
    hls.loadSource(currentStation.url);
    hls.attachMedia(audio);
    hls.on(Hls.Events.MANIFEST_PARSED, () => audio.play());
    hls.on(Hls.Events.ERROR, () => {
      if (currentStation.name.includes("World Service")) {
        metadataEl.textContent = "Stream unavailable in browser";
      }
    });
  } else {
    audio.src = currentStation.url;
    audio.play();
  }
}

async function fetchMetadata() {
  try {
    const res = await fetch(
      `https://rms.api.bbc.co.uk/v2/services/${currentStation.serviceId}/segments/latest`
    );
    const data = await res.json();
    const seg = data.data[0];
    const title = seg.titles?.primary || "";
    const artist = seg.titles?.secondary || "";
    metadataEl.textContent = artist ? `${artist} – ${title}` : title;
  } catch {
    metadataEl.textContent = "Live broadcast";
  }
}

function togglePlay() {
  audio.paused ? audio.play() : audio.pause();
}

playStation(0);
</script>

</body>
</html>
